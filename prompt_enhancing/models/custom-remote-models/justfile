LOCAL_PORT := "8884"
REMOTE_PORT := "8000"
REMOTE_SERVER_SSH_LOGIN := "mappa_cluster"

default:
  @just --list

sync:
  rsync --exclude-from=.gitignore -azvhP . \
    {{REMOTE_SERVER_SSH_LOGIN}}:raid/magoh_ai/inference-server

# Connect to the inference server through a ssh tunnel toward the cluster
connect_remote_server:
  @echo "You can now fetch your llm from http://localhost:{{LOCAL_PORT}}"
  ssh -N {{REMOTE_SERVER_SSH_LOGIN}} -L {{LOCAL_PORT}}:localhost:{{REMOTE_PORT}}

# On the remote server (must be in the venv)
run-server:
  fastapi run --port {{REMOTE_PORT}} ./src/magoh_ai_sup_server/server.py
